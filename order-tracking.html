<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Track Your Order | Artisans Store</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f2f7fb;
        }

        .header {
            background: #179fc5;
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header a {
            color: white;
            text-decoration: none;
            font-weight: bold;

        }

        .container {
            max-width: 1100px;
            margin: auto;
            padding: 20px;
        }

        /* Card layout */
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        /* Order header */
        .order-top {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .order-top div {
            margin-bottom: 10px;
        }

        /* Items */
        .item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .item img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            background: #f5f5f5;
            border-radius: 5px;
        }

        /* Bill */
        .bill p {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
        }

        .bill .total {
            font-weight: bold;
            font-size: 18px;
        }

        /* Progress */
        .progress-wrapper {
            margin-top: 20px;
        }

        .steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .step {
            font-size: 13px;
            text-align: center;
            flex: 1;
        }

        .step.active {
            color: #179fc5;
            font-weight: bold;
        }

        .bar {
            height: 8px;
            background: #ddd;
            border-radius: 10px;
            overflow: hidden;
        }

        .fill {
            height: 8px;
            width: 0%;
            background: #179fc5;
            transition: width 1s ease;
        }

        /* Support */
        .support {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
        }

        @media(max-width:700px) {
            .order-top {
                flex-direction: column;
            }
        }

        #currentStatus {
            margin-top: 15px;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div class="header">
        <h2>üì¶ Track Your Order</h2>
        <a href="home.html">‚¨Ö Continue Shopping</a>
    </div>

    <div class="container">

        <!-- Order Header -->
        <div class="card">
            <div class="order-top">
                <div>
                    <b>Order ID:</b> <span id="orderId"></span><br>
                    <b>Ordered On:</b> <span id="orderDate"></span>
                </div>
                <div>
                    <b>Payment:</b> <span id="paymentMethod"></span><br>
                    <b>Status:</b> <span id="paymentStatus"></span>
                </div>
                <div>
                    <b>Estimated Delivery:</b><br>
                    <span id="deliveryWindow"></span>
                </div>
            </div>
        </div>

        <!-- Delivery Info -->
        <div class="card">
            <h3>üìç Delivery Address</h3>
            <p id="addressInfo"></p>
        </div>

        <!-- Items -->
        <div class="card">
            <h3>üõç Items Ordered</h3>
            <div id="items"></div>
        </div>

        <!-- Bill -->
        <div class="card bill">
            <h3>üí∞ Order Summary</h3>
            <p><span>Subtotal</span><span>‚Çπ<span id="subTotal"></span></span></p>
            <p><span>Delivery</span><span>‚Çπ<span id="deliveryFee"></span></span></p>
            <p><span>Tax</span><span>‚Çπ<span id="tax"></span></span></p>
            <p class="total"><span>Total</span><span>‚Çπ<span id="grandTotal"></span></span></p>
        </div>

        <!-- Tracking -->
        <div class="card">
            <h3>üöö Order Status</h3>

            <div class="steps">
                <div class="step" id="s1">Order Placed</div>
                <div class="step" id="s2">Packed</div>
                <div class="step" id="s3">Shipped</div>
                <div class="step" id="s4">Out for Delivery</div>
                <div class="step" id="s5">Delivered</div>
            </div>

            <div class="bar">
                <div class="fill" id="fill"></div>
            </div>

            <p id="currentStatus"></p>
        </div>

        <div class="support">
            Need help with this order?<br>
            üìß support@artisansstore.com | üìû +91 96448 08780
        </div>

    </div>

    <script>
        // LOGIN GUARD
        let loggedInUser = localStorage.getItem("loggedInUser");
        // if (!loggedInUser) {
        //     alert("Please login to track orders");
        //     window.location.href = "auth.html";
        // }

        let ordersByUser = JSON.parse(localStorage.getItem("ordersByUser")) || {};
        let orders = ordersByUser[loggedInUser] || [];
        let activeOrderId = localStorage.getItem("activeOrderId");

        let order = orders.find(o => o.id === activeOrderId);
        if (!order) {
            alert("Order not found");
            window.location.href = "my-orders.html";
        }

        // INIT TRACKING FIELDS
        if (order.currentStep === undefined) {
            order.currentStep = 0;
            order.lastUpdated = Date.now();
        }

        const statusFlow = [
            "Order Placed",
            "Packed",
            "Shipped",
            "Out for Delivery",
            "Delivered"
        ];

        // UI SETUP
        document.getElementById("orderId").innerText = order.id;
        document.getElementById("orderDate").innerText =
            new Date(order.date).toLocaleString();
        document.getElementById("paymentMethod").innerText = order.payment;
        document.getElementById("paymentStatus").innerText =
            order.payment === "COD" ? "Pay on Delivery" : "Paid";
        document.getElementById("addressInfo").innerText =
            order.name + ", " + order.address + ", " + order.city;

        // Delivery window
        let d = new Date(order.date);
        let s = new Date(d); s.setDate(d.getDate() + 2);
        let e = new Date(d); e.setDate(d.getDate() + 4);
        document.getElementById("deliveryWindow").innerText =
            s.toDateString() + " ‚Äì " + e.toDateString();

        // Items
        let itemsDiv = document.getElementById("items");
        itemsDiv.innerHTML = "";
        order.items.forEach(p => {
            itemsDiv.innerHTML += `
      <div class="item">
        <img src="${p.image}">
        <div>${p.name}<br>${p.qty} √ó ‚Çπ${p.price}</div>
      </div>`;
        });

        document.getElementById("subTotal").innerText = order.subtotal;
        document.getElementById("deliveryFee").innerText = order.delivery;
        document.getElementById("tax").innerText = "0";
        document.getElementById("grandTotal").innerText = order.total;

        // STATUS UPDATE LOGIC
        function updateStatus() {
            if (order.currentStep >= statusFlow.length - 1) return;

            let now = Date.now();
            let diff = now - order.lastUpdated;

            // 1 minute per step (60000 ms)
            if (diff >= 60000) {
                order.currentStep++;
                order.status = statusFlow[order.currentStep];
                order.lastUpdated = now;

                ordersByUser[loggedInUser] = orders;
                localStorage.setItem("ordersByUser", JSON.stringify(ordersByUser));

                renderStatus();
            }
        }

        function renderStatus() {
            document.getElementById("currentStatus").innerText = order.status;
            document.getElementById("fill").style.width =
                ((order.currentStep + 1) / statusFlow.length) * 100 + "%";

            statusFlow.forEach((_, i) => {
                document.getElementById("s" + (i + 1))
                    .classList.toggle("active", i <= order.currentStep);
            });
        }

        renderStatus();
        setInterval(updateStatus, 5000); // check every 5 seconds

        // Initial cart count update
         function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const count = cart.reduce((s, i) => s + i.qty, 0);
            const el = document.getElementById("cartCount");
            if (el) el.innerText = count;
        }
        updateCartCount();
        
    </script>


</body>

</html>